local RunService = game:GetService("RunService")
local Players = game:GetService("Players")
local map = workspace:FindFirstChild("Map")
local player = Players.LocalPlayer

local ghost = workspace:WaitForChild("ServerNPCs"):WaitForChild("GLOBAL")

local evidence_folder = workspace.Dynamic.Evidence
local fingerprints = evidence_folder.Fingerprints
local dropped_equipment = workspace.Equipment
local motions = evidence_folder.MotionGrids
local orbs = evidence_folder.Orbs
local emfs = evidence_folder.EMF

local found_emf = false
local found_fingerprint = false
local found_orb = false
local got_motion = false
local no_motion = false

local trackedPart = ghost.PrimaryPart or ghost:FindFirstChildWhichIsA("BasePart")
if not trackedPart then
    warn("No part to track for ghost")
    return
end

if not map then
    warn("No se encontrÃ³ Map")
    return
end

local bone = map:FindFirstChild("Bone")
if not bone then
    warn("No se encontrÃ³ Bone")
    return
end

local billboard = Instance.new("BillboardGui")
billboard.Name = "BoneESP"
billboard.Adornee = bone 
billboard.AlwaysOnTop = true
billboard.Size = UDim2.new(0, 100, 0, 50)
billboard.StudsOffset = Vector3.new(0, 2, 0)
billboard.Parent = player:WaitForChild("PlayerGui")

local label = Instance.new("TextLabel")
label.Size = UDim2.new(1, 0, 1, 0)
label.BackgroundTransparency = 1
label.Text = "Bone"
label.TextColor3 = Color3.fromRGB(255, 0, 0)
label.TextScaled = true
label.Parent = billboard

local screenGui = Instance.new("ScreenGui")
screenGui.Name = "GhostSpeedGUI"
screenGui.ResetOnSpawn = false
screenGui.Parent = player:WaitForChild("PlayerGui")

local speedLabel = Instance.new("TextLabel")
speedLabel.Size = UDim2.new(0, 300, 0, 50)
speedLabel.Position = UDim2.new(0, 20, 0, 20)
speedLabel.BackgroundTransparency = 0.3
speedLabel.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
speedLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
speedLabel.TextScaled = true
speedLabel.Font = Enum.Font.SourceSansBold
speedLabel.Text = "Ghost Speed: 0"
speedLabel.Parent = screenGui

emfs.ChildAdded:Connect(function(emf)
    if emf:IsA("Part") then
        if emf.Name == "EMF5" and not found_emf then
            print("EMF 5: Yes")
            found_emf = true
        end
        print("Last EMF: " .. emf.Name)
    end
end)

fingerprints.ChildAdded:Connect(function(fingerprint)
    if fingerprint:IsA("Part") and not found_fingerprint then
        print("Fingerprints: Yes")
        found_fingerprint = true
    end
end)

orbs.ChildAdded:Connect(function(orb)
    if orb:IsA("Part") and not found_orb then
        print("Orbs: Yes")
        found_orb = true
    end
end)

local run_service = game:GetService("RunService")

local motionconnection
motionconnection = run_service.RenderStepped:Connect(function()
    for _, motion in pairs(motions:GetDescendants()) do
        if motion:IsA("Part") then
            if motion.Color == Color3.fromRGB(252, 52, 52) then
                print("Motion: Yes")
                got_motion = true
                motionconnection:Disconnect()
                break
            elseif motion.BrickColor == BrickColor.new("Toothpaste") then
                print("Motion: No")
                no_motion = true
                motionconnection:Disconnect()
                break
            end
        end
    end
end)


local function createESP(part)
    local billboard = Instance.new("BillboardGui")
    billboard.Name = "GhostESP"
    billboard.Adornee = part
    billboard.Size = UDim2.new(0, 150, 0, 40)
    billboard.AlwaysOnTop = true
    billboard.Parent = part

    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(1, 0, 1, 0)
    label.BackgroundTransparency = 1
    label.TextColor3 = Color3.fromRGB(255, 0, 0)
    label.TextScaled = true
    label.Font = Enum.Font.SourceSansBold
    label.Text = "Ghost ðŸ‘»"
    label.Parent = billboard
end

local screenGui = Instance.new("ScreenGui")
screenGui.Name = "BoneTPGui"
screenGui.Parent = player:WaitForChild("PlayerGui")

local button = Instance.new("TextButton")
button.Size = UDim2.new(0, 120, 0, 40)
button.Position = UDim2.new(0, 20, 0.5, -20) -- izquierda pantalla
button.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
button.TextColor3 = Color3.fromRGB(255, 255, 255)
button.Text = "TP to Bone"
button.Parent = screenGui

button.MouseButton1Click:Connect(function()
    local character = player.Character or player.CharacterAdded:Wait()
    local hrp = character:FindFirstChild("HumanoidRootPart")

    if hrp and bone then
        hrp.CFrame = bone.CFrame + Vector3.new(0, 5, 0) 
        print("Teletransportado al Bone")
    else
        warn("No se pudo teletransportar")
    end
end)

createESP(trackedPart)

RunService.RenderStepped:Connect(function()
    local speed = ghost:GetAttribute("Speed") or 0
    speedLabel.Text = "Ghost Speed: " .. string.format("%.1f", speed)

end)

